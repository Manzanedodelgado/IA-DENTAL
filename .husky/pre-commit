#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# ============================================================
# PRE-COMMIT HOOK - Protocolo SIGMA-99
# ============================================================

echo "üîç Ejecutando validaciones pre-commit..."

# 1. Prevenir commit de archivos .env
if git diff --cached --name-only | grep -q "\.env$"; then
  echo "‚ùå ERROR: Intento de commit de archivo .env detectado"
  echo "   Los archivos .env contienen credenciales y NO deben estar en el repositorio"
  echo ""
  echo "   Ejecuta: git rm --cached <archivo>.env"
  exit 1
fi

# 2. Ejecutar lint-staged (linting y formatting autom√°tico)
npx lint-staged

if [ $? -ne 0 ]; then
  echo "‚ùå ERROR: Lint-staged fall√≥"
  echo "   Corrige los errores de linting antes de commitear"
  exit 1
fi

# 3. Ejecutar linter de seguridad
npm run lint:security --silent

if [ $? -ne 0 ]; then
  echo "‚ùå ERROR: Problemas de seguridad detectados por ESLint"
  exit 1
fi

echo "‚úÖ Validaciones pre-commit completadas"
